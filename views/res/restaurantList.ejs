<% layout("/layouts/admin-layout.ejs") %>

  <style>
    .status-approved {
      background-color: #28a745;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
    }
    .status-not-approved {
      background-color: #dc3545;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
    }
    .table-img {
      width: 50px;
      height: 50px;
      object-fit: cover;
    }
    .action-buttons button {
      margin: 2px;
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center" id="dataTable">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Image</th>
          <th>foods</th>
          <th>Date</th>
          <th>Location</th>
          <th>Contact</th>
          <th>email</th>
          <th>Approved</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% for(x of allRestaurants){ %>
        <tr>
          <td><%=x.resId %></td>
          <td><%=x.title %></td>
          <td><img src="<%=x.imageLink %>" class="table-img" alt="img"></td>
          <td>
            <% for(y of x?.foods){ %>
            <%= y?.name %>
            <% } %>
          </td>
          <td><%=x.time %></td>
          <td><%-x.location.address %></td>
          <td><%=x?.contact %></td>
          <td><%=x.owner.email %></td>
          <td><span class="status-approved"><%=x.isApproved %></span></td>
          <td>
            <form action="/admin/restaurant/<%=x.resId %>?_method=DELETE" method="POST">
                       <button class="btn btn-danger btn-sm" >Delete</button>
            </form>
            <form action="/admin/restaurant/<%=x.resId %>?_method=PATCH" method="POST">
                       <button class="btn btn-success btn-sm" >Approve</button>
            </form>
            
          </td>
        </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this row?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" onclick="deleteRow()">Yes, Delete</button>
      </div>
    </div>
  </div>
</div>

<script>
  let rowToDelete = null;

  function confirmDelete(button) {
    rowToDelete = button.closest('tr');
    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
  }

  function deleteRow() {
    if (rowToDelete) {
      rowToDelete.remove();
      rowToDelete = null;
    }
    const modalEl = document.getElementById('deleteModal');
    const modal = bootstrap.Modal.getInstance(modalEl);
    modal.hide();
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>